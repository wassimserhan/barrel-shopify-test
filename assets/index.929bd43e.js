import{n as h}from"./index.4dec3c6a.js";import{l as g}from"./index.a394a8ae.js";let b=0;const j=(n,o={})=>{const e=`__c${b++}`,r=`${o.param||"callback"}=${e}`,u=o.timeout||6e4,m=o.response?o.response:(l,p)=>console.log(l,p),c=document.createElement("script"),a=()=>window[e]?i():null,s=u?setTimeout(function(){i(),m(new Error("Timeout"))},u):null,i=()=>{document.head.removeChild(c),window[e]=()=>{},s&&clearTimeout(s)};return window[e]=l=>{m(null,l),i()},c.src=`${n}&${r}`,document.head.appendChild(c),a},$=(n,...o)=>(o.forEach(e=>Object.keys(e).forEach(t=>n[t]=e[t])),n),f=n=>{let o="",e=Object.keys(n);for(let t=0;t<e.length;t++){let r=n[e[t]];o+=`${encodeURIComponent(r.name)}=${encodeURIComponent(r.value||"")}${t<e.length-1?"&":""}`}return o},v=n=>{let o=Object.keys(n);for(let e=0;e<o.length;e++)if(!n[o[e]].valid)return!1;return!0},d=n=>{let o=[].slice.call(n.querySelectorAll("[name]"))||!1;if(o)return o.map(e=>({name:e.getAttribute("name"),value:e.value||void 0,valid:!0,node:e}))},y=(n,o)=>o.forEach(e=>{let t=n.filter(r=>e.name instanceof RegExp?e.name.test(r.name):e.name===r.name)[0];t&&(e.validate(t)?(e.success&&e.success(t),t.valid=!0):(e.error&&e.error(t),t.valid=!1))}),w=(n,o)=>{const e=!!n.match(/\?/);return`${n}${e?"&":"?"}${f(o)}`},O=(n,o={})=>{const e=n.getAttribute("action")?n:n.getElementsByTagName("form")[0];let t=d(e);const r=Object.create(g({getFields:()=>t}));$(r,{method:"POST",tests:[],action:e.getAttribute("action"),jsonp:!1},o);function u(){j(w(r.action,t),{param:r.jsonp,response:(c,a)=>{let s={fields:t,res:c||a,req:null};c?r.emit("error",s):r.emit("success",s)}})}function m(){return h.ajax({url:r.action,body:f(t),method:r.method},(c,a,s)=>{let i=c>=200&&c<=300,l={fields:t,res:a,req:s};i?r.emit("success",l):r.emit("error",l)})}return e.onsubmit=c=>{c.preventDefault(),r.emit("submit"),t=d(e),y(t,r.tests),v(t)&&(r.jsonp?u():m())},r};export{O as c};
