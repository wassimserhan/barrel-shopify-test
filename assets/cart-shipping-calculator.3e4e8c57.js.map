{"version":3,"file":"cart-shipping-calculator.3e4e8c57.js","sources":["../node_modules/.pnpm/shopify-shipping-calculator@0.1.0/node_modules/shopify-shipping-calculator/src/lib/ajax.js","../node_modules/.pnpm/shopify-shipping-calculator@0.1.0/node_modules/shopify-shipping-calculator/src/lib/response.js","../node_modules/.pnpm/shopify-shipping-calculator@0.1.0/node_modules/shopify-shipping-calculator/src/lib/utils.js","../node_modules/.pnpm/shopify-shipping-calculator@0.1.0/node_modules/shopify-shipping-calculator/src/index.js","../modules/cart-shipping-calculator/cart-shipping-calculator.js"],"sourcesContent":["import nanoajax from 'nanoajax'\n\nconst toQueryString = (fields) => {\n  let data = ''\n  let names = Object.keys(fields)\n\n  for (let i = 0; i < names.length; i++){\n    let name = names[i]\n    let value = fields[name]\n    data += `${encodeURIComponent(`shipping_address[${name}]`)}=${encodeURIComponent(value)}${i < names.length -1 ? '&' : ''}`\n  }\n\n  return data\n}\n\nexport const requestShippingRates = (endpoint, data, cb) => nanoajax.ajax({\n  method: 'post',\n  url: endpoint,\n  body: toQueryString(data)\n}, cb)\n\nexport const fetchShippingRates = (endpoint, cb) => nanoajax.ajax({ url: endpoint }, cb)\n","export const formatSuccess = (data) => {\n  const res = [] \n  const rates = JSON.parse(data).shipping_rates\n\n  return rates ? rates.map(r => ({\n    type: r.name,\n    price: r.price\n  })) : null\n}\n\nexport const formatError = (data) => {\n  const parsed = JSON.parse(data)\n  const keys = Object.keys(parsed)\n\n  let res = ''\n\n  for (let i = 0; i < keys.length; i++){ \n    let key = keys[i]\n    res += `Error: ${key} ${parsed[key][0]}${i !== keys.length - 1 ? ', ' : ''}` \n  }\n\n  return res\n}\n","/**\n * @return {array} Array of provinces\n */\nexport const getProvinces = country => country ? Countries[country].provinces : null \n\n/**\n * Creates and returns an option with \n * the passed value as both the value \n * property and the innerHTML property.\n *\n * @param {string} val Label and value of option\n * @return {element} option element\n */\nconst createOption = (val = null) => {\n  if (!val){ return }\n\n  let el = document.createElement('option')\n\n  el.value = val\n  el.innerHTML = val\n\n  return el\n}\n\n/**\n * Select an option within a <select>\n * based on a given value\n *\n * @param {string} value Value to search for\n * @param {element} select <select> element\n * @return {element} The first matching select option\n */\nconst selectOption = (val, select) => [].slice.call(select.options).map((o, i) => {\n  if (o.value === val) select.selectedIndex = i\n})\n\n/**\n * Generate select options for a given select element\n *\n * @param {array} options Array of options \n * @return {string} the selected value of the target select element\n */ \nexport const updateSelectOptions = (target, options, selectedOption = null) => {\n  const prev = target.options[0] ? target.options[0].value : false \n\n  options = Array.isArray(options) ? options : Object.keys(options)\n\n  const shouldUpdate = !prev || options[0] !== prev ? true : false\n\n  if (shouldUpdate){\n    target.innerHTML = ''\n    options.forEach(o => target.appendChild(createOption(o)))\n  }\n\n  if (selectedOption){ selectOption(selectedOption, target) }\n\n  return target.value\n}\n","import loop from 'loop.js'\nimport { \n  requestShippingRates, \n  fetchShippingRates \n} from './lib/ajax'\nimport { \n  formatSuccess, \n  formatError \n} from './lib/response'\nimport { \n  updateSelectOptions,\n  getProvinces\n} from './lib/utils'\n\nif (typeof window.Countries !== 'object'){ throw new Error('The global Countries object required by your shipping calculator does not exist.') }\n\nexport default (el, opts = {}) => {\n  const defaultCountry = opts.defaultCountry || null\n  const endpoints = opts.endpoints || {\n    prepare: '/cart/prepare_shipping_rates',\n    get: '/cart/async_shipping_rates'\n  } \n\n  const countrySelect = el.querySelector('[name=\"country\"]') \n  const provinceSelect = el.querySelector('[name=\"province\"]') \n  const zipInput = el.querySelector('[name=\"zip\"]')\n  const submitButton = el.querySelector('[type=\"submit\"]')\n\n  const model = {\n    get country(){\n      return countrySelect.value\n    },\n    get province(){\n      return provinceSelect.value\n    },\n    get zip(){\n      return zipInput.value\n    },\n    get meta(){\n      return Countries[this.country]\n    }\n  }\n\n  const instance = Object.create(loop(), {\n    getState: {\n      value: () => model \n    }\n  })\n\n  countrySelect.addEventListener('change', e => {\n    let { provinces, zip_required } = Countries[model.country]\n\n    if (provinces){\n      updateSelectOptions(provinceSelect, provinces)\n      provinceSelect.disabled = false\n    } else {\n      provinceSelect.innerHTML = ''\n      provinceSelect.disabled = true\n    }\n\n    zip_required ? (\n      zipInput.disabled = false \n    ) : (\n      zipInput.disabled = true \n    )\n\n    instance.emit('change', model)\n  })\n\n  el.addEventListener('submit', e => {\n    e.preventDefault()\n    e.returnValue = false // IE support\n\n    instance.emit('submit', model)\n\n    submitButton.disabled = true\n\n    requestShippingRates(endpoints.prepare, model, (status, data, req) => {\n      let success = status >= 200 && status <= 300 ? true : false\n\n      if (success){\n        fetchShippingRates(endpoints.get, (status, data, req) => {\n          let response = formatSuccess(data)\n\n          instance.emit('success', response)\n        })\n      } else {\n        let response = formatError(data)\n        instance.emit('error', response)\n      }\n\n      submitButton.disabled = false \n    })\n  })\n\n  /**\n   * Init\n   */\n  updateSelectOptions(countrySelect, Countries, defaultCountry)\n  updateSelectOptions(provinceSelect, Countries[defaultCountry || Object.keys(Countries)[0]].provinces)\n\n  return instance \n}\n","import shipper from 'shopify-shipping-calculator'\n\nexport default (el) => {\n  const outer = el\n  const results = document.getElementById('shippingResults')\n  const province = document.getElementById('shippingProvince')\n  const zip = document.getElementById('shippingZip')\n  const provinceLabel = province.getElementsByTagName('label')[0]\n  const zipLabel = zip.getElementsByTagName('label')[0]\n\n  const ship = shipper(outer, {\n    defaultCountry: 'United States'\n  })\n\n  window.shipper = ship\n\n  const render = rates => (results.innerHTML = `\n    <div>\n      <p class=\"italic\">There ${rates.length > 1 ? `are ${rates.length} rates` : `is ${rates.length} rate`} available:</p>\n      <p class=\"p0\">\n      ${(rates.map(r => `<span class=\"bold\">${r.type}:</span><span>$${r.price}</span><br>`).join(''))}\n      </p>\n    </div>\n  `)\n\n  ship.on('success', render)\n  ship.on('error', res => console.warn(res))\n  ship.on('change', model => {\n    let meta = model.meta\n\n    // Clear results for next call\n    results.innerHTML = ''\n\n    !!model.province ? (\n      province.style.display = 'block'\n    ) : (\n      province.style.display = 'none'\n    )\n\n    !!meta.zip_required ? (\n      zip.style.display = 'block'\n    ) : (\n      zip.style.display = 'none'\n    )\n\n    zipLabel.innerHTML = `${meta.zip_label}:`\n    provinceLabel.innerHTML = `${meta.province_label}:`\n  })\n}\n"],"names":["toQueryString","fields","data","names","i","name","value","requestShippingRates","endpoint","cb","nanoajax","fetchShippingRates","formatSuccess","rates","r","formatError","parsed","keys","res","key","createOption","val","el","selectOption","select","o","updateSelectOptions","target","options","selectedOption","prev","shipper","opts","defaultCountry","endpoints","countrySelect","provinceSelect","zipInput","submitButton","model","instance","loop","e","provinces","zip_required","status","req","response","cartShippingCalculator","outer","results","province","zip","provinceLabel","zipLabel","ship","render","meta"],"mappings":"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","x_google_ignoreList":[0,1,2,3]}